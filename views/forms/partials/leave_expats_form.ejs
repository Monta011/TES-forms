<!-- Leave Application - Expats Form Fields -->
<div class="space-y-6">
  <!-- Employee Information Section -->
  <div class="bg-gray-50 p-4 rounded-lg">
    <h3 class="text-lg font-semibold text-gray-800 mb-4">Employee Information</h3>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- Employee Name -->
      <div>
        <label for="employeeName" class="block text-sm font-medium text-gray-700 mb-1">
          Employee Name <span class="text-red-500">*</span>
        </label>
        <input 
          type="text" 
          id="employeeName" 
          name="employeeName" 
          value="<%= formData.employeeName || '' %>"
          required
          class="w-full px-4 py-2 border <%= errors.employeeName ? 'border-red-500' : 'border-gray-300' %> rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        >
        <% if (errors.employeeName) { %>
          <p class="text-red-500 text-sm mt-1"><%= errors.employeeName %></p>
        <% } %>
      </div>

      <!-- Employee ID -->
      <div>
        <label for="employeeId" class="block text-sm font-medium text-gray-700 mb-1">
          Employee ID <span class="text-red-500">*</span>
        </label>
        <input 
          type="text" 
          id="employeeId" 
          name="employeeId" 
          value="<%= formData.employeeId || '' %>"
          required
          class="w-full px-4 py-2 border <%= errors.employeeId ? 'border-red-500' : 'border-gray-300' %> rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        >
        <% if (errors.employeeId) { %>
          <p class="text-red-500 text-sm mt-1"><%= errors.employeeId %></p>
        <% } %>
      </div>

      <!-- Form Date -->
      <div>
        <label for="formDate" class="block text-sm font-medium text-gray-700 mb-1">Form Date <% if (strictRequired) { %><span class="text-red-500">*</span><% } %></label>
        <input 
          type="date" 
          id="formDate" 
          name="formDate" 
          value="<%= formData.formDate || '' %>"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        >
        <% if (errors.formDate) { %><p class="text-red-500 text-sm mt-1"><%= errors.formDate %></p><% } %>
      </div>

      <!-- Position -->
      <div>
        <label for="position" class="block text-sm font-medium text-gray-700 mb-1">Position <% if (strictRequired) { %><span class="text-red-500">*</span><% } %></label>
          <% if (errors.position) { %><p class="text-red-500 text-sm mt-1"><%= errors.position %></p><% } %>
        <input 
          type="text" 
          id="position" 
          name="position" 
          value="<%= formData.position || '' %>"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        >
      </div>

      <!-- Site -->
      <div>
        <label for="site" class="block text-sm font-medium text-gray-700 mb-1">Site <% if (strictRequired) { %><span class="text-red-500">*</span><% } %></label>
          <% if (errors.site) { %><p class="text-red-500 text-sm mt-1"><%= errors.site %></p><% } %>
        <input 
          type="text" 
          id="site" 
          name="site" 
          value="<%= formData.site || '' %>"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        >
      </div>

      <!-- Mobile Number -->
      <div>
        <label for="mobileNo" class="block text-sm font-medium text-gray-700 mb-1">Mobile Number <% if (strictRequired) { %><span class="text-red-500">*</span><% } %></label>
          <% if (errors.mobileNo) { %><p class="text-red-500 text-sm mt-1"><%= errors.mobileNo %></p><% } %>
        <input 
          type="tel" 
          id="mobileNo" 
          name="mobileNo" 
          value="<%= formData.mobileNo || '' %>"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        >
      </div>
    </div>
  </div>

  <!-- Leave Request Section -->
  <div class="bg-gray-50 p-4 rounded-lg">
    <h3 class="text-lg font-semibold text-gray-800 mb-4">Leave Request</h3>
    
    <!-- Leave Type -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700 mb-2">Leave Type <% if (strictRequired) { %><span class="text-red-500">*</span><% } %></label>
        <% if (errors.leaveType) { %><p class="text-red-500 text-sm mt-1"><%= errors.leaveType %></p><% } %>
      <div class="space-y-2">
        <div class="flex items-center">
          <input 
            type="radio" 
            id="leaveTypeAnnual" 
            name="leaveType" 
            value="annual"
            <%= formData.leaveType === 'annual' ? 'checked' : '' %>
            class="h-4 w-4 text-blue-600 focus:ring-blue-500"
          >
          <label for="leaveTypeAnnual" class="ml-2 text-sm text-gray-700">Annual Leave</label>
        </div>
        <div class="flex items-center">
          <input 
            type="radio" 
            id="leaveTypeEmergency" 
            name="leaveType" 
            value="emergency"
            <%= formData.leaveType === 'emergency' ? 'checked' : '' %>
            class="h-4 w-4 text-blue-600 focus:ring-blue-500"
          >
          <label for="leaveTypeEmergency" class="ml-2 text-sm text-gray-700">Emergency Leave</label>
        </div>
        <div class="flex items-center">
          <input 
            type="radio" 
            id="leaveTypeMedical" 
            name="leaveType" 
            value="medical"
            <%= formData.leaveType === 'medical' ? 'checked' : '' %>
            class="h-4 w-4 text-blue-600 focus:ring-blue-500"
          >
          <label for="leaveTypeMedical" class="ml-2 text-sm text-gray-700">Medical Leave</label>
        </div>
        <div class="flex items-center">
          <input 
            type="radio" 
            id="leaveTypeAbsent" 
            name="leaveType" 
            value="absentWithoutPay"
            <%= formData.leaveType === 'absentWithoutPay' ? 'checked' : '' %>
            class="h-4 w-4 text-blue-600 focus:ring-blue-500"
          >
          <label for="leaveTypeAbsent" class="ml-2 text-sm text-gray-700">Absent Without Pay</label>
        </div>
        <div class="flex items-center">
          <input 
            type="radio" 
            id="leaveTypeHaj" 
            name="leaveType" 
            value="haj"
            <%= formData.leaveType === 'haj' ? 'checked' : '' %>
            class="h-4 w-4 text-blue-600 focus:ring-blue-500"
          >
          <label for="leaveTypeHaj" class="ml-2 text-sm text-gray-700">Haj Leave</label>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <!-- Commence Leave -->
      <div>
        <label for="commenceLeave" class="block text-sm font-medium text-gray-700 mb-1">Commence Leave <% if (strictRequired) { %><span class="text-red-500">*</span><% } %></label>
          <% if (errors.commenceLeave) { %><p class="text-red-500 text-sm mt-1"><%= errors.commenceLeave %></p><% } %>
        <input 
          type="date" 
          id="commenceLeave" 
          name="commenceLeave" 
          value="<%= formData.commenceLeave || '' %>"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        >
      </div>

      <!-- Last Day of Leave -->
      <div>
        <label for="lastDayLeave" class="block text-sm font-medium text-gray-700 mb-1">Last Day of Leave <% if (strictRequired) { %><span class="text-red-500">*</span><% } %></label>
          <% if (errors.lastDayLeave) { %><p class="text-red-500 text-sm mt-1"><%= errors.lastDayLeave %></p><% } %>
        <input 
          type="date" 
          id="lastDayLeave" 
          name="lastDayLeave" 
          value="<%= formData.lastDayLeave || '' %>"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        >
      </div>

      <!-- Total Days -->
      <div>
        <label for="totalDays" class="block text-sm font-medium text-gray-700 mb-1">Total Days <% if (strictRequired) { %><span class="text-red-500">*</span><% } %></label>
          <% if (errors.totalDays) { %><p class="text-red-500 text-sm mt-1"><%= errors.totalDays %></p><% } %>
        <input 
          type="number" 
          id="totalDays" 
          name="totalDays" 
          value="<%= formData.totalDays || '' %>"
          min="0"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        >
      </div>
    </div>
  </div>

  <!-- Expatriate Options Section -->
  <div class="bg-gray-50 p-4 rounded-lg">
    <h3 class="text-lg font-semibold text-gray-800 mb-4">Expatriate Options</h3>
    
    <!-- Airport Name -->
    <div class="mb-4">
      <label for="airportName" class="block text-sm font-medium text-gray-700 mb-1">Airport Name <% if (strictRequired) { %><span class="text-red-500">*</span><% } %></label>
        <% if (errors.airportName) { %><p class="text-red-500 text-sm mt-1"><%= errors.airportName %></p><% } %>
      <input 
        type="text" 
        id="airportName" 
        name="airportName" 
        value="<%= formData.airportName || '' %>"
        placeholder="e.g., Dubai International Airport"
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
      >
    </div>

    <!-- Payment Options (Radio) -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700 mb-2">Payment Options <% if (strictRequired) { %><span class="text-red-500">*</span><% } %></label>
        <% if (errors.paymentOption) { %><p class="text-red-500 text-sm mt-1"><%= errors.paymentOption %></p><% } %>
      <div class="space-y-2">
        <div class="flex items-center">
          <input 
            type="radio" 
            id="paymentAdvance" 
            name="paymentOption" 
            value="advance"
            <%= formData.paymentOption === 'advance' ? 'checked' : '' %>
            class="h-4 w-4 text-blue-600 focus:ring-blue-500"
          >
          <label for="paymentAdvance" class="ml-2 text-sm text-gray-700">Payment in Advance</label>
        </div>
        <div class="flex items-center">
          <input 
            type="radio" 
            id="paymentAfterReturn" 
            name="paymentOption" 
            value="afterReturn"
            <%= formData.paymentOption === 'afterReturn' ? 'checked' : '' %>
            class="h-4 w-4 text-blue-600 focus:ring-blue-500"
          >
          <label for="paymentAfterReturn" class="ml-2 text-sm text-gray-700">Payment After Return</label>
        </div>
      </div>
    </div>

    <!-- Ticket Options (Radio) -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700 mb-2">Ticket Options <% if (strictRequired) { %><span class="text-red-500">*</span><% } %></label>
        <% if (errors.ticketOption) { %><p class="text-red-500 text-sm mt-1"><%= errors.ticketOption %></p><% } %>
      <div class="space-y-2">
        <div class="flex items-center">
          <input 
            type="radio" 
            id="issueMyTicket" 
            name="ticketOption" 
            value="myTicket"
            <%= formData.ticketOption === 'myTicket' ? 'checked' : '' %>
            class="h-4 w-4 text-blue-600 focus:ring-blue-500"
          >
          <label for="issueMyTicket" class="ml-2 text-sm text-gray-700">Issue My Ticket</label>
        </div>
        <div class="flex items-center">
          <input 
            type="radio" 
            id="issueTicketFamily" 
            name="ticketOption" 
            value="family"
            <%= formData.ticketOption === 'family' ? 'checked' : '' %>
            class="h-4 w-4 text-blue-600 focus:ring-blue-500"
          >
          <label for="issueTicketFamily" class="ml-2 text-sm text-gray-700">Issue Ticket for Family</label>
        </div>
      </div>
    </div>

    <!-- Compensation -->
    <div>
      <div class="flex items-center">
        <input 
          type="checkbox" 
          id="wantCompensation" 
          name="wantCompensation" 
          value="true"
          <%= formData.wantCompensation ? 'checked' : '' %>
          class="h-4 w-4 text-blue-600 focus:ring-blue-500 rounded"
        >
        <label for="wantCompensation" class="ml-2 text-sm text-gray-700">Want Compensation Instead of Ticket</label>
      </div>
    </div>
  </div>

    <!-- Signatures Section -->
    <div class="bg-gray-50 p-4 rounded-lg">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Signatures</h3>
      <div class="space-y-8">
        <%- include('signature_block', {
          title: 'Employee to sign',
          subtitle: 'I declare this to be a true and accurate record of my absence.',
          idPrefix: 'employeeSignature',
          fieldName: 'employeeSignature',
          dateFieldName: 'employeeSignatureDate',
          formData,
          errors
        }) %>

        <%- include('signature_block', {
          title: 'Asst. Project Manager / Engineer to authorize',
          subtitle: '',
          idPrefix: 'managerSignature',
          fieldName: 'managerSignature',
          dateFieldName: 'managerSignatureDate',
          formData,
          errors
        }) %>

        <%- include('signature_block', {
          title: 'HR Manager to authorize',
          subtitle: '',
          idPrefix: 'hrSignature',
          fieldName: 'hrSignature',
          dateFieldName: 'hrSignatureDate',
          formData,
          errors
        }) %>
      </div>
    </div>
</div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const commence = document.getElementById('commenceLeave');
      const lastDay = document.getElementById('lastDayLeave');
      const totalDays = document.getElementById('totalDays');

      function parseDate(val) {
        return val ? new Date(val + 'T00:00:00') : null;
      }

      function formatISO(date) {
        if (!date) return '';
        const y = date.getFullYear();
        const m = String(date.getMonth() + 1).padStart(2, '0');
        const d = String(date.getDate()).padStart(2, '0');
        return `${y}-${m}-${d}`;
      }

      function daysBetweenInclusive(start, end) {
        if (!start || !end) return '';
        const ms = end - start;
        const days = Math.floor(ms / (1000 * 60 * 60 * 24)) + 1; // inclusive
        return days > 0 ? days : '';
      }

      function updateTotalDaysFromDates() {
        const start = parseDate(commence.value);
        const end = parseDate(lastDay.value);
        const days = daysBetweenInclusive(start, end);
        totalDays.value = days === '' ? '' : days;
      }

      function updateLastDayFromTotal() {
        const start = parseDate(commence.value);
        const days = parseInt(totalDays.value, 10);
        if (start && Number.isFinite(days) && days > 0) {
          const end = new Date(start);
          end.setDate(end.getDate() + (days - 1));
          lastDay.value = formatISO(end);
        }
      }

      commence.addEventListener('change', function() {
        if (totalDays.value) {
          updateLastDayFromTotal();
        } else {
          updateTotalDaysFromDates();
        }
      });
      lastDay.addEventListener('change', updateTotalDaysFromDates);
      totalDays.addEventListener('input', updateLastDayFromTotal);

      // initialize for edit mode
      if (commence.value && lastDay.value) {
        updateTotalDaysFromDates();
      } else if (commence.value && totalDays.value) {
        updateLastDayFromTotal();
      }
    });
  </script>
